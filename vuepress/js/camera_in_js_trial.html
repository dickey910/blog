<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS控制设备摄像头初探 | 前端学习笔记</title>
    <meta name="description" content="前端大乱炖——web前端,HTML5,CSS3,Javascript,SVG,canvas,vue...">
    <meta name="keywords" content="web前端,HTML5,CSS3,Javascript,SVG,canvas,vue...">
  <meta name="anthor" content="Denzel">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
  <link rel="icon" href="/blog/vuepress/logo.png">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    
    <link rel="preload" href="/blog/vuepress/assets/css/0.styles.9a0cee9f.css" as="style"><link rel="preload" href="/blog/vuepress/assets/js/app.f02a9d9e.js" as="script"><link rel="preload" href="/blog/vuepress/assets/js/4.04d9dabe.js" as="script"><link rel="preload" href="/blog/vuepress/assets/js/74.ef9f8768.js" as="script"><link rel="preload" href="/blog/vuepress/assets/js/43.75708b12.js" as="script"><link rel="preload" href="/blog/vuepress/assets/js/35.9d53a773.js" as="script"><link rel="preload" href="/blog/vuepress/assets/js/19.be7df768.js" as="script"><link rel="prefetch" href="/blog/vuepress/assets/js/1.e8bd26c9.js"><link rel="prefetch" href="/blog/vuepress/assets/js/10.574803c8.js"><link rel="prefetch" href="/blog/vuepress/assets/js/100.0ba1c1c3.js"><link rel="prefetch" href="/blog/vuepress/assets/js/101.7cef64b7.js"><link rel="prefetch" href="/blog/vuepress/assets/js/102.34250842.js"><link rel="prefetch" href="/blog/vuepress/assets/js/103.2446b8e5.js"><link rel="prefetch" href="/blog/vuepress/assets/js/104.f5191572.js"><link rel="prefetch" href="/blog/vuepress/assets/js/105.a9031c25.js"><link rel="prefetch" href="/blog/vuepress/assets/js/106.d5f78526.js"><link rel="prefetch" href="/blog/vuepress/assets/js/107.4904e047.js"><link rel="prefetch" href="/blog/vuepress/assets/js/108.42aff882.js"><link rel="prefetch" href="/blog/vuepress/assets/js/109.6f67fa6b.js"><link rel="prefetch" href="/blog/vuepress/assets/js/11.a58c51ba.js"><link rel="prefetch" href="/blog/vuepress/assets/js/110.c70d15c0.js"><link rel="prefetch" href="/blog/vuepress/assets/js/111.961d3baa.js"><link rel="prefetch" href="/blog/vuepress/assets/js/112.2a8cfa82.js"><link rel="prefetch" href="/blog/vuepress/assets/js/113.31efc15a.js"><link rel="prefetch" href="/blog/vuepress/assets/js/114.dd92eacb.js"><link rel="prefetch" href="/blog/vuepress/assets/js/115.debaffea.js"><link rel="prefetch" href="/blog/vuepress/assets/js/12.2804f2a6.js"><link rel="prefetch" href="/blog/vuepress/assets/js/13.f24a2cf5.js"><link rel="prefetch" href="/blog/vuepress/assets/js/14.0362bfb2.js"><link rel="prefetch" href="/blog/vuepress/assets/js/15.d51e6736.js"><link rel="prefetch" href="/blog/vuepress/assets/js/16.d9d07ae4.js"><link rel="prefetch" href="/blog/vuepress/assets/js/17.2ecc4f15.js"><link rel="prefetch" href="/blog/vuepress/assets/js/18.3ea25d14.js"><link rel="prefetch" href="/blog/vuepress/assets/js/20.c1db08af.js"><link rel="prefetch" href="/blog/vuepress/assets/js/21.46822465.js"><link rel="prefetch" href="/blog/vuepress/assets/js/22.2939826f.js"><link rel="prefetch" href="/blog/vuepress/assets/js/23.c0a1d316.js"><link rel="prefetch" href="/blog/vuepress/assets/js/24.ba638cc8.js"><link rel="prefetch" href="/blog/vuepress/assets/js/25.1a88795b.js"><link rel="prefetch" href="/blog/vuepress/assets/js/26.e709d941.js"><link rel="prefetch" href="/blog/vuepress/assets/js/27.3e0f5548.js"><link rel="prefetch" href="/blog/vuepress/assets/js/28.5363b078.js"><link rel="prefetch" href="/blog/vuepress/assets/js/29.30f890c7.js"><link rel="prefetch" href="/blog/vuepress/assets/js/30.5622a90d.js"><link rel="prefetch" href="/blog/vuepress/assets/js/31.81d7747e.js"><link rel="prefetch" href="/blog/vuepress/assets/js/32.43a1fd59.js"><link rel="prefetch" href="/blog/vuepress/assets/js/33.3b1acde0.js"><link rel="prefetch" href="/blog/vuepress/assets/js/34.ca0e9fd0.js"><link rel="prefetch" href="/blog/vuepress/assets/js/36.e286f05e.js"><link rel="prefetch" href="/blog/vuepress/assets/js/37.5a63acca.js"><link rel="prefetch" href="/blog/vuepress/assets/js/38.407f1306.js"><link rel="prefetch" href="/blog/vuepress/assets/js/39.7977d311.js"><link rel="prefetch" href="/blog/vuepress/assets/js/40.9976d936.js"><link rel="prefetch" href="/blog/vuepress/assets/js/41.c2266866.js"><link rel="prefetch" href="/blog/vuepress/assets/js/42.f1eda770.js"><link rel="prefetch" href="/blog/vuepress/assets/js/44.1bd28aa9.js"><link rel="prefetch" href="/blog/vuepress/assets/js/45.cdc7f9e4.js"><link rel="prefetch" href="/blog/vuepress/assets/js/46.acfb2788.js"><link rel="prefetch" href="/blog/vuepress/assets/js/47.c4c9e2d0.js"><link rel="prefetch" href="/blog/vuepress/assets/js/48.8d8b580c.js"><link rel="prefetch" href="/blog/vuepress/assets/js/49.c1467d38.js"><link rel="prefetch" href="/blog/vuepress/assets/js/5.68b3e0b4.js"><link rel="prefetch" href="/blog/vuepress/assets/js/50.cf5406cb.js"><link rel="prefetch" href="/blog/vuepress/assets/js/51.547e3c96.js"><link rel="prefetch" href="/blog/vuepress/assets/js/52.c9bf2d1b.js"><link rel="prefetch" href="/blog/vuepress/assets/js/53.54933755.js"><link rel="prefetch" href="/blog/vuepress/assets/js/54.831deced.js"><link rel="prefetch" href="/blog/vuepress/assets/js/55.18c26f97.js"><link rel="prefetch" href="/blog/vuepress/assets/js/56.231fb3bc.js"><link rel="prefetch" href="/blog/vuepress/assets/js/57.d530da83.js"><link rel="prefetch" href="/blog/vuepress/assets/js/58.853007bb.js"><link rel="prefetch" href="/blog/vuepress/assets/js/59.a6dd98f2.js"><link rel="prefetch" href="/blog/vuepress/assets/js/6.5be46806.js"><link rel="prefetch" href="/blog/vuepress/assets/js/60.5756cce1.js"><link rel="prefetch" href="/blog/vuepress/assets/js/61.30bebe8b.js"><link rel="prefetch" href="/blog/vuepress/assets/js/62.88f59d4c.js"><link rel="prefetch" href="/blog/vuepress/assets/js/63.5a15bc3b.js"><link rel="prefetch" href="/blog/vuepress/assets/js/64.dadcf0ae.js"><link rel="prefetch" href="/blog/vuepress/assets/js/65.e9f2cd01.js"><link rel="prefetch" href="/blog/vuepress/assets/js/66.c1b0f295.js"><link rel="prefetch" href="/blog/vuepress/assets/js/67.b4b44da1.js"><link rel="prefetch" href="/blog/vuepress/assets/js/68.bbddd340.js"><link rel="prefetch" href="/blog/vuepress/assets/js/69.c74005e1.js"><link rel="prefetch" href="/blog/vuepress/assets/js/7.cc0216db.js"><link rel="prefetch" href="/blog/vuepress/assets/js/70.9800f565.js"><link rel="prefetch" href="/blog/vuepress/assets/js/71.8e5dc553.js"><link rel="prefetch" href="/blog/vuepress/assets/js/72.6b0317cb.js"><link rel="prefetch" href="/blog/vuepress/assets/js/73.04d7758b.js"><link rel="prefetch" href="/blog/vuepress/assets/js/75.6caa9719.js"><link rel="prefetch" href="/blog/vuepress/assets/js/76.312e3b01.js"><link rel="prefetch" href="/blog/vuepress/assets/js/77.9d9192b7.js"><link rel="prefetch" href="/blog/vuepress/assets/js/78.8e147740.js"><link rel="prefetch" href="/blog/vuepress/assets/js/79.ffb0bc20.js"><link rel="prefetch" href="/blog/vuepress/assets/js/8.740e5f25.js"><link rel="prefetch" href="/blog/vuepress/assets/js/80.980e242e.js"><link rel="prefetch" href="/blog/vuepress/assets/js/81.62897024.js"><link rel="prefetch" href="/blog/vuepress/assets/js/82.2f512384.js"><link rel="prefetch" href="/blog/vuepress/assets/js/83.41088249.js"><link rel="prefetch" href="/blog/vuepress/assets/js/84.877bb37d.js"><link rel="prefetch" href="/blog/vuepress/assets/js/85.60ec0abb.js"><link rel="prefetch" href="/blog/vuepress/assets/js/86.b5895e9d.js"><link rel="prefetch" href="/blog/vuepress/assets/js/87.28b7dbd2.js"><link rel="prefetch" href="/blog/vuepress/assets/js/88.7b146985.js"><link rel="prefetch" href="/blog/vuepress/assets/js/89.4a319ee5.js"><link rel="prefetch" href="/blog/vuepress/assets/js/9.d684cd49.js"><link rel="prefetch" href="/blog/vuepress/assets/js/90.227d812c.js"><link rel="prefetch" href="/blog/vuepress/assets/js/91.25ed94b6.js"><link rel="prefetch" href="/blog/vuepress/assets/js/92.f1e69ede.js"><link rel="prefetch" href="/blog/vuepress/assets/js/93.291796d3.js"><link rel="prefetch" href="/blog/vuepress/assets/js/94.bc4b087a.js"><link rel="prefetch" href="/blog/vuepress/assets/js/95.228415dd.js"><link rel="prefetch" href="/blog/vuepress/assets/js/96.2d66e72e.js"><link rel="prefetch" href="/blog/vuepress/assets/js/97.7c33cd44.js"><link rel="prefetch" href="/blog/vuepress/assets/js/98.18aa172d.js"><link rel="prefetch" href="/blog/vuepress/assets/js/99.a32ec63d.js"><link rel="prefetch" href="/blog/vuepress/assets/js/vendors~notification.d5e78cba.js">
    <link rel="stylesheet" href="/blog/vuepress/assets/css/0.styles.9a0cee9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/vuepress/" class="home-link router-link-active"><img src="/blog/vuepress/logo.png" alt="前端学习笔记" class="logo"> <span class="site-name can-hide">前端学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/vuepress/js/" class="nav-link router-link-active">JS</a></div><div class="nav-item"><a href="/blog/vuepress/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/blog/vuepress/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/blog/vuepress/else/" class="nav-link">其他</a></div><div class="nav-item"><a href="/blog/vuepress/study/" class="nav-link">study</a></div> <a href="https://github.com/xiaotianxia" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/vuepress/js/" class="nav-link router-link-active">JS</a></div><div class="nav-item"><a href="/blog/vuepress/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/blog/vuepress/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/blog/vuepress/else/" class="nav-link">其他</a></div><div class="nav-item"><a href="/blog/vuepress/study/" class="nav-link">study</a></div> <a href="https://github.com/xiaotianxia" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/vuepress/js/" class="sidebar-link">目录</a></li><li><a href="/blog/vuepress/js/four_kinds_of_observers.html" class="sidebar-link">JS中的观察者们 —— 四种 Observers</a></li><li><a href="/blog/vuepress/js/editable_dom.html" class="sidebar-link">可编辑的页面——designMode、contenteditable和user-modify</a></li><li><a href="/blog/vuepress/js/useful_webapis_mediarecorder.html" class="sidebar-link">用浏览器轻松录制音频、视频—— MediaRecorder API</a></li><li><a href="/blog/vuepress/js/useful_webapis_audiocontext.html" class="sidebar-link">让你的网页开口说话 —— audioContext API</a></li><li><a href="/blog/vuepress/js/useful_webapis_fullscreen.html" class="sidebar-link">几个有用的Web API——全屏模式</a></li><li><a href="/blog/vuepress/js/useful_webapis_notification.html" class="sidebar-link">几个有用的Web API——桌面通知API</a></li><li><a href="/blog/vuepress/js/useful_webapis_connection.html" class="sidebar-link">几个有用的Web API——网络状态API</a></li><li><a href="/blog/vuepress/js/useful_webapis_geolocation.html" class="sidebar-link">几个有用的Web API——地理位置API</a></li><li><a href="/blog/vuepress/js/speech_in_js_recognition.html" class="sidebar-link">JS中的语音识别——Speech Recognition API</a></li><li><a href="/blog/vuepress/js/speech_in_js_synthesis.html" class="sidebar-link">JS中的语音合成——Speech Synthesis API</a></li><li><a href="/blog/vuepress/js/camera_in_js_trial.html" class="active sidebar-link">JS控制设备摄像头初探</a></li><li><a href="/blog/vuepress/js/shape_detection_api_trial.html" class="sidebar-link">浏览器的图像识别API初探</a></li><li><a href="/blog/vuepress/js/simple_chatroom_using_socketio.html" class="sidebar-link">socket.io实现简单群聊</a></li><li><a href="/blog/vuepress/js/communication_using_postmessage.html" class="sidebar-link">postMessage实现父子页面简单通信</a></li><li><a href="/blog/vuepress/js/upload_using_filereader_createobjecturl.html" class="sidebar-link">FileReader与URL.createObjectURL实现图片、视频上传预览</a></li><li><a href="/blog/vuepress/js/simple_code_preview.html" class="sidebar-link">前端几行代码简单实现w3school代码预览</a></li><li><a href="/blog/vuepress/js/scroll_behaviors.html" class="sidebar-link">简单盘点浏览器的几种滚动行为</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="js控制设备摄像头初探"><a href="#js控制设备摄像头初探" aria-hidden="true" class="header-anchor">#</a> JS控制设备摄像头初探</h1> <p><a href="https://xiaotianxia.github.io/blog/vuepress/js/camera_in_js_trial.html" target="_blank" rel="noopener noreferrer">原文链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="主要内容"><a href="#主要内容" aria-hidden="true" class="header-anchor">#</a> 主要内容</h2> <ul><li><a href="#%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E6%91%84%E5%83%8F%E5%A4%B4%E4%BF%A1%E6%81%AF">获取设备摄像头信息</a></li> <li><a href="#%E5%88%A9%E7%94%A8%E6%91%84%E5%83%8F%E5%A4%B4%E6%88%AA%E5%9B%BE%E5%B9%B6%E4%BF%9D%E5%AD%98">利用摄像头截图并保存</a></li> <li><a href="#%E6%89%8B%E5%8A%A8%E6%8E%A7%E5%88%B6%E5%89%8D%E5%90%8E%E7%BD%AE%E6%91%84%E5%83%8F%E5%A4%B4">手动控制前后置摄像头</a></li></ul> <hr> <h3 id="获取设备摄像头信息"><a href="#获取设备摄像头信息" aria-hidden="true" class="header-anchor">#</a> 获取设备摄像头信息</h3> <p>html中添加一个video元素，设置属性为autoplay，以便在获取视频流之后立即播放，也可以在获取视频流之后手动控制播放(play方法)。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">autoplay</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>利用<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener noreferrer">navigator.mediaDevices.getUserMedia<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>获取视频流。之前的方法是<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/getUserMedia" target="_blank" rel="noopener noreferrer">navigator.getUserMedia()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,为向后兼容此方法已废弃。</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>目前pc端高级浏览器支持比较好，手机端貌似只有<strong>Safari</strong>支持😢 。</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    audio<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
    video<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>stream <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'error: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="codepen-wrapper"><a href="https://codepen.io/_tianxia/pen/odMNxa" target="_blank" class="el-button el-button--primary is-plain">show in codepen <i class="el-icon-d-arrow-right"></i></a></div> <h3 id="利用摄像头截图并保存"><a href="#利用摄像头截图并保存" aria-hidden="true" class="header-anchor">#</a> 利用摄像头截图并保存</h3> <p>截图的思路无非就是把动态的video存为瞬间的静态的image。利用canvas可以很简单快速的把视频帧存为静态图片，首先在video上层覆盖一个透明的canvas容器。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">autoplay</span> <span class="token attr-name">playsinline</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button snap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>截图<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button save hide<span class="token punctuation">&quot;</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>test.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>保存<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>保存，利用a标签的新属性download，只要把图片地址赋给download属性即可以实现下载。图片地址的生成利用URL.createObjectURL方法，具体请看下面代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    snapBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.snap'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    saveBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.save'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cxt <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    audio<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
    video<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>stream <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
    snapBtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        saveBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'hide'</span><span class="token punctuation">,</span> <span class="token string">'show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cxt<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            snapBtn<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'取消'</span><span class="token punctuation">;</span>
            saveBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">//canvas转图片保存</span>
            canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    saveBtn<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            cxt<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            snapBtn<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'截图'</span><span class="token punctuation">;</span>
            saveBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'error: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>这里不足的是canvas和video的适配还有问题，导致截图和视频的比例很多时候不一致，还望大神指点🙏 。</p> <div class="codepen-wrapper"><a href="https://codepen.io/_tianxia/pen/YLjPNq" target="_blank" class="el-button el-button--primary is-plain">show in codepen <i class="el-icon-d-arrow-right"></i></a></div> <h3 id="手动控制前后置摄像头"><a href="#手动控制前后置摄像头" aria-hidden="true" class="header-anchor">#</a> 手动控制前后置摄像头</h3> <h4 id="获取可用摄像头"><a href="#获取可用摄像头" aria-hidden="true" class="header-anchor">#</a> 获取可用摄像头</h4> <p>添加select用于获取可用摄像头并手动选择指定摄像头：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">autoplay</span> <span class="token attr-name">playsinline</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button confirm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button snap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript:;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>截图<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button save hide<span class="token punctuation">&quot;</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>test.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>保存<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/enumerateDevices" target="_blank" rel="noopener noreferrer">navigator.mediaDevices.enumerateDevices<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用于获取所有可用音频和视频输入设备的方式。</p> <p>在移动端，<a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints/facingModes" target="_blank" rel="noopener noreferrer">MediaTrackConstraints.facingMode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用于前后置摄像头的调整比较方便，其值为'user(前置)'、'environment(后置)'、'left(前置左)'、'right(前置右)'，后两种不常见，目前还没有两个前置摄像头的手机吧😂 。</p> <p>切换摄像头时首先切断当前视频流（所有轨道)，用stream.getTracks()获取所轨道，stop()方法停止该轨道。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    select <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    confirmBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.confirm'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    snapBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.snap'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    saveBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.save'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cxt <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>getDevices<span class="token punctuation">)</span><span class="token punctuation">;</span>

navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    audio<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
    video<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>stream <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
    snapBtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        saveBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'hide'</span><span class="token punctuation">,</span> <span class="token string">'show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cxt<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            snapBtn<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'取消'</span><span class="token punctuation">;</span>
            saveBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

            canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    saveBtn<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            cxt<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            snapBtn<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'截图'</span><span class="token punctuation">;</span>
            saveBtn<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'error: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

confirmBtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> currentStream <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">stopMediaTracks</span><span class="token punctuation">(</span>currentStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> videoConstraints <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>select<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        videoConstraints<span class="token punctuation">.</span>facingMode <span class="token operator">=</span> <span class="token string">'environment'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        videoConstraints<span class="token punctuation">.</span>deviceId <span class="token operator">=</span> <span class="token punctuation">{</span> exact<span class="token punctuation">:</span> select<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
        video<span class="token punctuation">:</span> videoConstraints<span class="token punctuation">,</span>
        audio<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    navigator<span class="token punctuation">.</span>mediaDevices
        <span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>stream <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            currentStream <span class="token operator">=</span> stream<span class="token punctuation">;</span>
            video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getDevices</span><span class="token punctuation">(</span>devices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    select<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    select<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'option'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    devices<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>device <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>device<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">'videoinput'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> option <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'option'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            option<span class="token punctuation">.</span>value <span class="token operator">=</span> device<span class="token punctuation">.</span>deviceId<span class="token punctuation">;</span>
            <span class="token keyword">const</span> label <span class="token operator">=</span> device<span class="token punctuation">.</span>label <span class="token operator">||</span> <span class="token template-string"><span class="token string">`相机 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token operator">++</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
            option<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            select<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">stopMediaTracks</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>track <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><div class="codepen-wrapper"><a href="https://codepen.io/_tianxia/pen/aGjvqa" target="_blank" class="el-button el-button--primary is-plain">show in codepen <i class="el-icon-d-arrow-right"></i></a></div> <h2 id="或者看这里"><a href="#或者看这里" aria-hidden="true" class="header-anchor">#</a> 或者看这里</h2> <p>(没有？刷新之后‘允许使用摄像头’试试？)
<div class="iframe-wrapper" style="height:500px;"><iframe src="https://xiaotianxia.github.io/demos-2018/camera-in-js/index.html?_=1556076590272" frameborder="0"></iframe></div></p> <h2 id="还可以做什么"><a href="#还可以做什么" aria-hidden="true" class="header-anchor">#</a> 还可以做什么</h2> <ul><li>结合上一篇的人脸识别，就可以实现视频中的人脸识别了</li> <li>直播，尤其是手机浏览器端直播</li> <li>等你来头脑风暴</li></ul> <h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener noreferrer">MediaDevices.getUserMedia<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.twilio.com/blog/2018/04/choosing-cameras-javascript-mediadevices-api.html" target="_blank" rel="noopener noreferrer">Choosing cameras in JavaScript with the mediaDevices API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新: </span> <span class="time">4/23/2019, 11:11:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/vuepress/js/speech_in_js_synthesis.html" class="prev">
          JS中的语音合成——Speech Synthesis API
        </a></span> <span class="next"><a href="/blog/vuepress/js/shape_detection_api_trial.html">
          浏览器的图像识别API初探
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/vuepress/assets/js/app.f02a9d9e.js" defer></script><script src="/blog/vuepress/assets/js/4.04d9dabe.js" defer></script><script src="/blog/vuepress/assets/js/74.ef9f8768.js" defer></script><script src="/blog/vuepress/assets/js/43.75708b12.js" defer></script><script src="/blog/vuepress/assets/js/35.9d53a773.js" defer></script><script src="/blog/vuepress/assets/js/19.be7df768.js" defer></script>
  </body>
</html>
